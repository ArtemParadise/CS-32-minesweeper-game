<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ú—ñ–Ω–µ—Ä</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    h1 {
      margin-bottom: 10px;
    }
    #info {
      margin-bottom: 10px;
    }
    #game {
      display: grid;
      gap: 2px;
      margin-top: 10px;
    }
    .cell {
      width: 30px;
      height: 30px;
      background: #ccc;
      text-align: center;
      line-height: 30px;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
    }
    .opened {
      background: #eee;
    }
    .flagged {
      background: #f99;
    }
  </style>
</head>
<body>
  <h1>–ú—ñ–Ω–µ—Ä</h1>
  <div id="info">
    <button onclick="startGame()">–ù–æ–≤–∞ –≥—Ä–∞</button>
    <span id="timer">‚è± 0 —Å–µ–∫</span>
  </div>
  <div id="game"></div>

  <script>
    let field = [], opened = [], flags = [];
    let rows = 8, cols = 8, mines = 10;
    let gameOver = false, timer = null, seconds = 0;
    let firstClick = true;

    function startGame() {
      field = Array.from({ length: rows }, () => Array(cols).fill(0));
      opened = Array.from({ length: rows }, () => Array(cols).fill(false));
      flags = Array.from({ length: rows }, () => Array(cols).fill(false));
      gameOver = false;
      firstClick = true;
      seconds = 0;
      clearInterval(timer);
      document.getElementById("timer").textContent = "‚è± 0 —Å–µ–∫";
      renderField();
    }

    function placeMines(safeRow, safeCol) {
      let placed = 0;
      while (placed < mines) {
        let r = Math.floor(Math.random() * rows);
        let c = Math.floor(Math.random() * cols);
        if (Math.abs(r - safeRow) <= 1 && Math.abs(c - safeCol) <= 1) continue;
        if (field[r][c] !== "M") {
          field[r][c] = "M";
          placed++;
        }
      }
    }

    function countNeighbourMines(row, col) {
      if (field[row][col] === "M") return "üí£";
      let count = 0;
      for (let dr = -1; dr <= 1; dr++) {
        for (let dc = -1; dc <= 1; dc++) {
          let nr = row + dr, nc = col + dc;
          if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
            if (field[nr][nc] === "M") count++;
          }
        }
      }
      return count;
    }

    function openCell(row, col) {
      if (gameOver || opened[row][col] || flags[row][col]) return;

      if (firstClick) {
        placeMines(row, col);
        firstClick = false;
        startTimer();
      }

      if (field[row][col] === "M") {
        alert("‚ùå –í–∏ –ø—ñ–¥—ñ—Ä–≤–∞–ª–∏—Å—å. –ì—Ä–∞ –∑–∞–∫—ñ–Ω—á–µ–Ω–∞.");
        gameOver = true;
        stopTimer();
        opened[row][col] = true;
        renderField();
        return;
      }

      let count = countNeighbourMines(row, col);
      opened[row][col] = true;

      if (count === 0) {
        for (let dr = -1; dr <= 1; dr++) {
          for (let dc = -1; dc <= 1; dc++) {
            let nr = row + dr, nc = col + dc;
            if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
              if (!opened[nr][nc]) openCell(nr, nc);
            }
          }
        }
      }

      renderField();
    }

    function toggleFlag(row, col) {
      if (opened[row][col] || gameOver || firstClick) return;
      flags[row][col] = !flags[row][col];
      renderField();
    }

    function startTimer() {
      timer = setInterval(() => {
        seconds++;
        document.getElementById("timer").textContent = `‚è± ${seconds} —Å–µ–∫`;
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timer);
      timer = null;
    }

    function renderField() {
      const gameDiv = document.getElementById("game");
      gameDiv.innerHTML = "";
      gameDiv.style.gridTemplateColumns = `repeat(${cols}, 30px)`;

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.dataset.row = r;
          cell.dataset.col = c;

          if (opened[r][c]) {
            cell.classList.add("opened");
            const val = countNeighbourMines(r, c);
            cell.textContent = val === 0 ? "" : val;
          } else {
            if (flags[r][c]) {
              cell.textContent = "üö©";
              cell.classList.add("flagged");
            }
          }

          cell.onclick = () => openCell(r, c);
          cell.oncontextmenu = (e) => {
            e.preventDefault();
            toggleFlag(r, c);
          };

          gameDiv.appendChild(cell);
        }
      }
    }

    startGame(); // –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
  </script>
</body>
</html>